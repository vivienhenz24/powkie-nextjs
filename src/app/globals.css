@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-dm-sans);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --color-app-secondary: var(--app-secondary);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

body {
  font-family: var(--font-dm-sans), sans-serif;
}

:root {
  --radius: 0.625rem;
  --background: oklch(0.145 0 0);
  --app-secondary: oklch(0.18 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
  html {
    scroll-behavior: smooth;
  }
}

/* Hide Mapbox branding and controls */
.mapboxgl-ctrl-logo,
.mapboxgl-ctrl-attrib,
.mapboxgl-ctrl-zoom-in,
.mapboxgl-ctrl-zoom-out,
.mapboxgl-ctrl-compass,
.mapboxgl-ctrl-group {
  display: none !important;
}

/* Dark mode styling for Mapbox popups so text is readable */
.mapboxgl-popup .mapboxgl-popup-content {
  background-color: var(--card) !important;
  color: var(--card-foreground) !important;
  border-radius: 0.75rem;
  padding: 0.75rem 1rem;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.45);
}

.mapboxgl-popup .mapboxgl-popup-tip {
  border-top-color: var(--card) !important;
  border-bottom-color: var(--card) !important;
}

.mapboxgl-popup-close-button {
  color: var(--muted-foreground) !important;
}

/* Glassmorphism utilities */
.glass {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
}

.glass-strong {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.25);
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
}

/* Smooth animations for homepage */
@keyframes slideInFromLeft {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInFromRight {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInFromBottom {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInFromTop {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes zoomIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes zoomOut {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.95);
  }
}

@keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

@keyframes slideInFromTop {
  from {
    opacity: 0;
    transform: translateY(-16px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInFromBottom {
  from {
    opacity: 0;
    transform: translateY(16px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Exit animations */
.animate-out {
  animation-fill-mode: forwards;
}

.fade-out {
  animation: fadeOut 0.3s ease-out forwards;
}

.zoom-out-95 {
  animation: zoomOut 0.5s ease-out forwards;
}

.slide-out-from-top-4 {
  animation: slideOutFromTop 0.3s ease-out forwards;
}

.slide-out-from-bottom-4 {
  animation: slideOutFromBottom 0.3s ease-out forwards;
}

@keyframes slideOutFromTop {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-16px);
  }
}

@keyframes slideOutFromBottom {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(16px);
  }
}

/* Smooth scroll behavior */
html {
  scroll-behavior: smooth;
}

/* Enhanced transitions for interactive elements */
input, textarea, select {
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

input:focus, textarea:focus, select:focus {
  transform: scale(1.01);
  transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Smooth panel transitions */
[class*="panel"], [class*="Panel"] {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Realistic Shuffling Animations - Based on actual shuffling techniques */

/* Cycle through shuffle types with circular fan-out */
@keyframes cycle-shuffles-with-fan {
  /* Phase 1: Stacked (0-5%) */
  0%, 5% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Phase 2: Fan out in circle (5-30%) */
  8% {
    transform: 
      translateX(calc(var(--circle-x, 0px) * 0.3)) 
      translateY(calc(var(--circle-y, 0px) * 0.3 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.05);
    opacity: 1;
  }
  
  20% {
    transform: 
      translateX(calc(var(--circle-x, 0px) * 0.7)) 
      translateY(calc(var(--circle-y, 0px) * 0.7 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.1);
    opacity: 1;
  }
  
  25% {
    transform: 
      translateX(var(--circle-x, 0px)) 
      translateY(calc(var(--circle-y, 0px) + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.15);
    opacity: 1;
  }
  
  /* Phase 3: Hold in circle (30-35%) - no movement, just stay fanned */
  30%, 35% {
    transform: 
      translateX(var(--circle-x, 0px)) 
      translateY(calc(var(--circle-y, 0px) + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.15);
    opacity: 1;
  }
  
  /* Phase 4: Return from circle (35-60%) - much faster return */
  42% {
    transform: 
      translateX(calc(var(--circle-x, 0px) * 0.4)) 
      translateY(calc(var(--circle-y, 0px) * 0.4 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) * 0.4 + 36deg)) 
      scale(1.06);
    opacity: 1;
  }
  
  52% {
    transform: 
      translateX(calc(var(--circle-x, 0px) * 0.15)) 
      translateY(calc(var(--circle-y, 0px) * 0.15 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) * 0.15 + 13.5deg)) 
      scale(1.02);
    opacity: 0.95;
  }
  
  60% {
    transform: 
      translateX(0px) 
      translateY(calc(-2px + var(--stack-offset, 0px))) 
      rotateZ(0deg) 
      scale(1.01);
    opacity: 0.95;
  }
  
  /* Phase 5: Stack back (60-65%) */
  65% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Phase 6: Up and down shuffle - cards cycle from front to back (65-90%) */
  /* Cards move up in waves, with front cards (lower index) going up first and cycling to back */
  68% {
    /* Start - front cards begin to lift */
    transform: 
      translateX(0px) 
      translateY(calc(var(--stack-offset, 0px) - (var(--card-index, 0) * 4px))) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  73% {
    /* Front cards lift up - lower index cards go higher */
    transform: 
      translateX(0px) 
      translateY(calc(var(--stack-offset, 0px) - 45px + (var(--card-index, 0) * 1px))) 
      rotateZ(calc(var(--card-index, 0) * 1deg)) 
      scale(1.1);
    opacity: 1;
  }
  
  80% {
    /* Cards at peak - front cards are highest, ready to cycle to back */
    transform: 
      translateX(0px) 
      translateY(calc(var(--stack-offset, 0px) - 60px + (var(--card-index, 0) * 2px))) 
      rotateZ(calc(var(--card-index, 0) * 1.5deg)) 
      scale(1.15);
    opacity: 1;
  }
  
  87% {
    /* Cards descending - front cards moving to back position */
    transform: 
      translateX(0px) 
      translateY(calc(var(--stack-offset, 0px) - 25px + ((var(--card-index, 0) + 8) * 0.3px))) 
      rotateZ(calc((var(--card-index, 0) + 8) * 0.3deg)) 
      scale(1.05);
    opacity: 1;
  }
  
  90% {
    /* Cards settle - positions have cycled (front cards now at back) */
    transform: 
      translateX(0px) 
      translateY(calc(var(--stack-offset, 0px) - 2px)) 
      rotateZ(0deg) 
      scale(1.01);
    opacity: 0.95;
  }
  
  /* Phase 7: Settle back to stack (90-100%) */
  95% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Seamless loop - match start state (100% = 0%) */
  100% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
}

/* Individual shuffle animations (kept for reference) */
@keyframes riffle-shuffle {
  0%, 15% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Split deck in half */
  20% {
    transform: 
      translateX(calc((var(--is-left, 0) * -50px - 25px))) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(calc((var(--is-left, 0) * -3deg - 1.5deg))) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Lift halves up and angle them */
  30% {
    transform: 
      translateX(calc((var(--is-left, 0) * -60px - 30px))) 
      translateY(calc(-40px + var(--stack-offset, 0px))) 
      rotateZ(calc((var(--is-left, 0) * -10deg - 5deg))) 
      scale(1.15);
    opacity: 1;
  }
  
  /* Cards cascade down and interleave - riffle motion */
  45% {
    transform: 
      translateX(calc((var(--is-left, 0) * -25px - 12.5px) + (var(--is-left, 0) * var(--position-in-half, 0) * 3px))) 
      translateY(calc(-25px + var(--stack-offset, 0px) + (var(--is-left, 0) * var(--position-in-half, 0) * 2px))) 
      rotateZ(calc((var(--is-left, 0) * -5deg - 2.5deg))) 
      scale(1.1);
    opacity: 1;
  }
  
  50% {
    transform: 
      translateX(calc((var(--is-left, 0) * 10px + 5px) - ((1 - var(--is-left, 0)) * var(--position-in-half, 0) * 3px))) 
      translateY(calc(-20px + var(--stack-offset, 0px) + ((1 - var(--is-left, 0)) * var(--position-in-half, 0) * 2px))) 
      rotateZ(calc((var(--is-left, 0) * 5deg + 2.5deg))) 
      scale(1.1);
    opacity: 1;
  }
  
  /* Cards settle together */
  65% {
    transform: 
      translateX(0px) 
      translateY(calc(-5px + var(--stack-offset, 0px))) 
      rotateZ(0deg) 
      scale(1.02);
    opacity: 0.95;
  }
  
  /* Return to stack */
  85%, 100% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
}

/* Overhand Shuffle - Pull small packets from deck and drop on top */
@keyframes overhand-shuffle {
  0%, 12% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Pull packet out to the right */
  20% {
    transform: 
      translateX(calc(40px + var(--card-index, 0) * 1.5px)) 
      translateY(calc(-20px + var(--stack-offset, 0px))) 
      rotateZ(calc(20deg + var(--card-index, 0) * 2deg)) 
      scale(1.1);
    opacity: 1;
  }
  
  /* Lift packet higher */
  35% {
    transform: 
      translateX(calc(50px + var(--card-index, 0) * 2px)) 
      translateY(calc(-50px + var(--stack-offset, 0px))) 
      rotateZ(calc(30deg + var(--card-index, 0) * 3deg)) 
      scale(1.2);
    opacity: 1;
  }
  
  /* Drop packet on top */
  50% {
    transform: 
      translateX(calc(20px + var(--card-index, 0) * 1px)) 
      translateY(calc(-60px + var(--stack-offset, 0px))) 
      rotateZ(calc(15deg + var(--card-index, 0) * 1.5deg)) 
      scale(1.15);
    opacity: 1;
  }
  
  /* Settle back */
  70% {
    transform: 
      translateX(0px) 
      translateY(calc(-3px + var(--stack-offset, 0px))) 
      rotateZ(0deg) 
      scale(1.01);
    opacity: 0.95;
  }
  
  90%, 100% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
}

/* Hindu Shuffle - Pull cards from bottom and place on top */
@keyframes hindu-shuffle {
  0%, 10% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Pull cards from bottom to the right */
  25% {
    transform: 
      translateX(calc(60px + var(--card-index, 0) * 2px)) 
      translateY(calc(10px + var(--stack-offset, 0px))) 
      rotateZ(calc(10deg + var(--card-index, 0) * 1deg)) 
      scale(1.1);
    opacity: 1;
  }
  
  /* Lift cards up */
  40% {
    transform: 
      translateX(calc(45px + var(--card-index, 0) * 1.5px)) 
      translateY(calc(-30px + var(--stack-offset, 0px))) 
      rotateZ(calc(5deg + var(--card-index, 0) * 0.5deg)) 
      scale(1.15);
    opacity: 1;
  }
  
  /* Place on top */
  55% {
    transform: 
      translateX(calc(10px + var(--card-index, 0) * 0.5px)) 
      translateY(calc(-50px + var(--stack-offset, 0px))) 
      rotateZ(calc(2deg + var(--card-index, 0) * 0.2deg)) 
      scale(1.1);
    opacity: 1;
  }
  
  /* Return to stack */
  75% {
    transform: 
      translateX(0px) 
      translateY(calc(-2px + var(--stack-offset, 0px))) 
      rotateZ(0deg) 
      scale(1.01);
    opacity: 0.95;
  }
  
  95%, 100% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
}

/* Faro Shuffle - Perfect interweaving of two halves */
@keyframes faro-shuffle {
  0%, 15% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scaleY(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Split deck */
  20% {
    transform: 
      translateX(calc((var(--is-left, 0) * -45px - 22.5px))) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(calc((var(--is-left, 0) * -2deg - 1deg))) 
      scaleY(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Lift and angle for interweaving */
  30% {
    transform: 
      translateX(calc((var(--is-left, 0) * -50px - 25px))) 
      translateY(calc(-25px + var(--stack-offset, 0px))) 
      rotateZ(calc((var(--is-left, 0) * -4deg - 2deg))) 
      scaleY(0.95);
    opacity: 1;
  }
  
  /* Perfect interweaving - cards slide between each other */
  45% {
    transform: 
      translateX(calc((var(--is-left, 0) * -20px - 10px) + (var(--is-left, 0) * var(--position-in-half, 0) * 2.5px))) 
      translateY(calc(-15px + var(--stack-offset, 0px) + (var(--is-left, 0) * var(--position-in-half, 0) * 1.5px))) 
      rotateZ(calc((var(--is-left, 0) * -2deg - 1deg))) 
      scaleY(0.9);
    opacity: 1;
  }
  
  50% {
    transform: 
      translateX(calc((var(--is-left, 0) * 8px + 4px) - ((1 - var(--is-left, 0)) * var(--position-in-half, 0) * 2.5px))) 
      translateY(calc(-12px + var(--stack-offset, 0px) + ((1 - var(--is-left, 0)) * var(--position-in-half, 0) * 1.5px))) 
      rotateZ(calc((var(--is-left, 0) * 2deg + 1deg))) 
      scaleY(0.9);
    opacity: 1;
  }
  
  /* Merge together */
  65% {
    transform: 
      translateX(0px) 
      translateY(calc(-3px + var(--stack-offset, 0px))) 
      rotateZ(0deg) 
      scaleY(1);
    opacity: 0.95;
  }
  
  85%, 100% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scaleY(1);
    opacity: var(--card-opacity, 0.9);
  }
}

/* Legacy Circle Shuffle - Cards fan out in full circle from left to right, shuffle, then return */
@keyframes circle-shuffle {
  /* Phase 1: Cards stacked in center - start and end state must match exactly */
  0% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  8% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Phase 2: Fan out into circle from left to right (10-30%) */
  15% {
    transform: 
      translateX(calc(var(--circle-x, 0px) * 0.3)) 
      translateY(calc(var(--circle-y, 0px) * 0.3 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.05);
    opacity: 1;
  }
  
  25% {
    transform: 
      translateX(calc(var(--circle-x, 0px) * 0.7)) 
      translateY(calc(var(--circle-y, 0px) * 0.7 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.1);
    opacity: 1;
  }
  
  30% {
    transform: 
      translateX(var(--circle-x, 0px)) 
      translateY(calc(var(--circle-y, 0px) + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.15);
    opacity: 1;
  }
  
  /* Phase 3: Hold in circle (30-40%) */
  35%, 40% {
    transform: 
      translateX(var(--circle-x, 0px)) 
      translateY(calc(var(--circle-y, 0px) + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.15);
    opacity: 1;
  }
  
  /* Phase 4: Shuffle - cards move to shuffled positions (40-60%) */
  45% {
    transform: 
      translateX(calc(var(--shuffled-x, 0px) * 0.7)) 
      translateY(calc(var(--shuffled-y, 0px) * 0.7 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--shuffled-angle, 0deg) + 90deg + var(--card-index, 0) * 3deg)) 
      scale(1.2);
    opacity: 1;
  }
  
  50% {
    transform: 
      translateX(calc(var(--shuffled-x, 0px) * 0.9)) 
      translateY(calc(var(--shuffled-y, 0px) * 0.9 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--shuffled-angle, 0deg) + 90deg + var(--card-index, 0) * 6deg)) 
      scale(1.25);
    opacity: 1;
  }
  
  55% {
    transform: 
      translateX(var(--shuffled-x, 0px)) 
      translateY(calc(var(--shuffled-y, 0px) + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--shuffled-angle, 0deg) + 90deg + var(--card-index, 0) * 8deg)) 
      scale(1.3);
    opacity: 1;
  }
  
  60% {
    transform: 
      translateX(calc(var(--shuffled-x, 0px) * 0.9)) 
      translateY(calc(var(--shuffled-y, 0px) * 0.9 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--shuffled-angle, 0deg) + 90deg + var(--card-index, 0) * 6deg)) 
      scale(1.25);
    opacity: 1;
  }
  
  /* Phase 5: Return to circle positions (60-75%) */
  70% {
    transform: 
      translateX(calc(var(--circle-x, 0px) * 0.7)) 
      translateY(calc(var(--circle-y, 0px) * 0.7 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.15);
    opacity: 1;
  }
  
  75% {
    transform: 
      translateX(calc(var(--circle-x, 0px) * 0.5)) 
      translateY(calc(var(--circle-y, 0px) * 0.5 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) + 90deg)) 
      scale(1.1);
    opacity: 1;
  }
  
  /* Phase 6: Come back together to center (75-92%) */
  82% {
    transform: 
      translateX(calc(var(--circle-x, 0px) * 0.2)) 
      translateY(calc(var(--circle-y, 0px) * 0.2 + var(--stack-offset, 0px))) 
      rotateZ(calc(var(--angle, 0deg) * 0.3)) 
      scale(1.05);
    opacity: 0.95;
  }
  
  88% {
    transform: 
      translateX(0px) 
      translateY(calc(-1px + var(--stack-offset, 0px))) 
      rotateZ(0deg) 
      scale(1.005);
    opacity: var(--card-opacity, 0.9);
  }
  
  /* Phase 7: Stack back into deck and hold - must match 0% exactly (92-100%) */
  92% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
  
  100% {
    transform: 
      translateX(0px) 
      translateY(var(--stack-offset, 0px)) 
      rotateZ(0deg) 
      scale(1);
    opacity: var(--card-opacity, 0.9);
  }
}

/* Page transition animations */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.page-enter {
  animation: fadeIn 0.4s ease-out;
}

/* Smooth link transitions */
a {
  transition: color 0.2s ease, opacity 0.2s ease, transform 0.2s ease;
  transform: translateZ(0);
  will-change: color, opacity;
}

/* Smooth button transitions */
button {
  transition: all 0.2s ease;
  transform: translateZ(0);
  will-change: transform, background-color, color;
}

/* Prevent animation jitter on navigation */
* {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* GPU acceleration for animated elements */
[class*="animate-"],
[style*="animation"] {
  will-change: transform, opacity;
  transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* Prevent initial animation jitter */
@keyframes fadeInSmooth {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Ensure bounce animation is smooth */
@keyframes bounce {
  0%, 100% {
    transform: translateY(0) translateZ(0);
  }
  50% {
    transform: translateY(-25%) translateZ(0);
  }
}

/* Prevent layout shifts during transitions */
html {
  scroll-behavior: smooth;
}

body {
  overflow-x: hidden;
}

/* Smooth page transitions */
.page-transition-enter {
  animation: pageEnter 0.3s ease-out;
}

.page-transition-exit {
  animation: pageExit 0.3s ease-in;
}

@keyframes pageEnter {
  from {
    opacity: 0;
    transform: translateX(30px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

@keyframes pageExit {
  from {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
  to {
    opacity: 0;
    transform: translateX(-30px) scale(0.95);
  }
}

/* Text pop-up animations */
@keyframes textPopUp {
  0% {
    opacity: 0;
    transform: translateY(20px) scale(0.9);
  }
  60% {
    transform: translateY(-5px) scale(1.02);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.text-pop-up {
  animation: textPopUp 0.6s ease-out forwards;
  opacity: 0;
}

.text-pop-up-delay-1 {
  animation: textPopUp 0.6s ease-out 0.1s forwards;
  opacity: 0;
}

.text-pop-up-delay-2 {
  animation: textPopUp 0.6s ease-out 0.2s forwards;
  opacity: 0;
}

.text-pop-up-delay-3 {
  animation: textPopUp 0.6s ease-out 0.3s forwards;
  opacity: 0;
}

.text-pop-up-delay-4 {
  animation: textPopUp 0.6s ease-out 0.4s forwards;
  opacity: 0;
}
